{% extends "base.html" %}

{% load compress static %}

{% block title %}
  Stravos: Dashboard
{% endblock title %}
{% block content %}
  {% compress js %}
    <script defer>
      navigator.geolocation.getCurrentPosition(function(position) {
        const user_latitude = position.coords.latitude;
        const user_longitude = position.coords.longitude;

        {
          %
          for event in events %
        }
        // Call the Django view that uses the `calculate_distance` template tag here.
        $.ajax({
          url: '/api/distance/', // The URL of the Django view
          data: {
            'user_latitude': user_latitude,
            'user_longitude': user_longitude,
            'event_latitude': {
              {
                event.location.latitude
              }
            }, // Replace with the actual event latitude
            'event_longitude': {
              {
                event.location.longitude
              }
            }, // Replace with the actual event longitude
          },
          success: function(data) {
            // Display the calculated distance on the page
            $('#distance-{{ event.id }}').text(data.distance + ' KM.');
          }
        });
        {
          %
          endfor %
        }
      });
    </script>
  {% endcompress %}
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h1>Dashboard</h1>
        <p>
          Welcome to the Stravos dashboard. Here you can view your recent activities, and see how you're doing against your goals.
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <h2>Recent Activities</h2>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Date</th>
              <th>Activity</th>
              <th>Distance</th>
              <th>Time</th>
            </tr>
          </thead>
          <tbody>
            {% for event in events %}
              <tr>
                <td>{{ event.start_date_local|date:'d/m/Y' }}</td>
                <td>{{ event.name }}</td>
                <td id="distance-{{ event.id }}">calculating...</td>
                {% comment %}Calculating gets replaced by the real location{% endcomment %}
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="col-md-6">
        <h2>Goals</h2>
        <p>Here you can set goals for yourself, and track your progress against them.</p>
        <p>Coming soon...</p>
      </div>
    </div>
  </div>
{% endblock content %}
